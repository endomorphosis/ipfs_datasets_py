# Dockerfile for MCP Dashboard and Integration tests
FROM python:3.12-slim

# Install system dependencies including Playwright requirements
RUN apt-get update && apt-get install -y \
    git \
    curl \
    build-essential \
    wget \
    gnupg \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copy application files
COPY setup.py README.md ./
COPY ipfs_datasets_py/ ./ipfs_datasets_py/
COPY tests/ ./tests/
COPY validate_mcp_dashboard.py mcp_dashboard_tests.py ./

# Install package with test dependencies
RUN pip install --no-cache-dir -e .[test] && \
    pip install --no-cache-dir \
        flask \
        mcp \
        pytest \
        pytest-cov \
        playwright

# Install Playwright browsers
RUN playwright install --with-deps chromium

# Set environment variables
ENV PYTHONUNBUFFERED=1
ENV MCP_DASHBOARD_PORT=8899
ENV MCP_DASHBOARD_HOST=127.0.0.1

# Run MCP tests by default
CMD ["pytest", "tests/", "-v", \
     "--cov=ipfs_datasets_py", \
     "--cov-report=xml", \
     "--cov-report=term", \
     "--junit-xml=/app/test-results/mcp-test-results.xml"]
